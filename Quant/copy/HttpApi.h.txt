#pragma once

#include "HtmlHelpers.h"
#include "TradeDatabase.h"

#include "Routes_Core.h"
#include "Routes_Trades.h"
#include "Routes_Profit.h"
#include "Routes_Horizons.h"
#include "Routes_Entry.h"
#include "Routes_Exit.h"
#include "Routes_PriceCheck.h"
#include "Routes_SerialGen.h"
#include "Routes_Chart.h"
#include "Routes_Api.h"

#include <mutex>
#include <thread>
#include <iostream>

// ---- HTTP server ----
inline void startHttpApi(TradeDatabase& db, int port, std::mutex& dbMutex)
{
    httplib::Server svr;

    registerCoreRoutes(svr, db, dbMutex);
    registerTradeRoutes(svr, db, dbMutex);
    registerProfitRoutes(svr, db, dbMutex);
    registerHorizonRoutes(svr, db, dbMutex);
    registerEntryRoutes(svr, db, dbMutex);
    registerExitRoutes(svr, db, dbMutex);
    registerPriceCheckRoutes(svr, db, dbMutex);
    registerSerialGenRoutes(svr, db, dbMutex);
    registerChartRoutes(svr, db, dbMutex);
    registerApiRoutes(svr, db, dbMutex);

    std::cout << "  [HTTP] listening on http://localhost:" << port << "\n";
    svr.listen("0.0.0.0", port);
}
